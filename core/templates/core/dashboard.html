{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Dashboard - Trust Bank</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        /* ====== BASE VARIABLES ====== */
        :root {
            --bg: #f6f8fb;
            --accent: #0466c8;
            --accent-2: #00aaff;
            --muted: #6b7280;
            --card: #ffffff;
            --glass: rgba(255,255,255,0.6);
            --radius: 14px;
            --shadow: 0 10px 30px rgba(12,34,66,0.08);
            --glass-shadow: 0 6px 18px rgba(12,34,66,0.06);
        }
        
        /* ====== RESET & BASE STYLES ====== */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        html, body { 
            height: 100%; 
        }
        
        body {
            margin: 0;
            font-family: "Poppins", "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(180deg, var(--bg), #eef4ff);
            color: #102a43;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.5;
        }
        
        a { 
            color: var(--accent); 
            text-decoration: none; 
        }
        
        a:hover { 
            opacity: 0.9; 
        }
        
        /* ====== NAVBAR STYLES ====== */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 32px;
            z-index: 1200;
            background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.92));
            backdrop-filter: blur(6px);
            border-bottom: 1px solid rgba(15,23,42,0.03);
        }
        
        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .brand img {
            width: 44px;
            height: 44px;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .brand h1 {
            font-size: 20px;
            margin: 0;
            font-weight: 700;
            color: #04293a;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-links a {
            font-weight: 600;
            color: #04293a;
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .nav-links a:hover {
            background: rgba(4,102,200,0.06);
        }
        
        .nav-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* ====== BUTTON STYLES ====== */
        .btn {
            padding: 9px 16px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid rgba(4,102,200,0.12);
            color: var(--accent);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: white;
            box-shadow: 0 8px 22px rgba(4,102,200,0.12);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(4,102,200,0.2);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        /* ====== DASHBOARD CONTAINER ====== */
        .dashboard-container {
            padding: 100px 32px 40px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* ====== DASHBOARD HEADER ====== */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .dashboard-header h1 {
            font-size: 32px;
            color: #04293a;
            margin: 0;
        }
        
        .welcome-message {
            color: var(--muted);
            font-size: 15px;
        }
        
        .welcome-message span {
            color: var(--accent);
            font-weight: 600;
        }
        
        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        /* ====== BALANCE CARDS GRID ====== */
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #0466c8, #00aaff);
            color: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(4,102,200,0.15);
        }
        
        .balance-card.secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .balance-card.tertiary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }
        
        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .balance-amount {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .balance-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .balance-change.positive {
            color: #10b981;
        }
        
        .balance-change.negative {
            color: #ef4444;
        }
        
        /* ====== QUICK ACTIONS GRID ====== */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .action-card {
            background: var(--card);
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(11,22,44,0.04);
            cursor: pointer;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(12,34,66,0.12);
        }
        
        .action-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(4,102,200,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 22px;
            color: var(--accent);
        }
        
        .action-card h3 {
            margin: 0 0 8px;
            font-size: 16px;
            color: #04293a;
        }
        
        .action-card p {
            color: var(--muted);
            font-size: 13px;
            margin: 0;
        }
        
        /* ====== DASHBOARD SECTIONS ====== */
        .dashboard-section {
            margin-bottom: 40px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            font-size: 20px;
            color: #04293a;
            margin: 0;
        }
        
        /* ====== TRANSACTIONS TABLE ====== */
        .transactions-table {
            background: var(--card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid rgba(11,22,44,0.04);
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 18px 25px;
            background: rgba(4,102,200,0.03);
            font-weight: 600;
            color: #04293a;
            font-size: 14px;
            border-bottom: 1px solid rgba(4,102,200,0.05);
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 18px 25px;
            border-bottom: 1px solid rgba(4,102,200,0.05);
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .table-row:hover {
            background: rgba(4,102,200,0.02);
        }
        
        .transaction-amount {
            font-weight: 600;
        }
        
        .transaction-amount.positive {
            color: #10b981;
        }
        
        .transaction-amount.negative {
            color: #ef4444;
        }
        
        .transaction-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-completed {
            background: rgba(16,185,129,0.1);
            color: #10b981;
        }
        
        .status-pending {
            background: rgba(245,158,11,0.1);
            color: #f59e0b;
        }
        
        /* ====== LOANS GRID ====== */
        .loans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .loan-card {
            background: var(--card);
            padding: 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(11,22,44,0.04);
        }
        
        .loan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .loan-type {
            font-weight: 600;
            color: #04293a;
        }
        
        .loan-amount {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
            color: #04293a;
        }
        
        .loan-progress {
            height: 6px;
            background: rgba(4,102,200,0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .loan-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            border-radius: 3px;
        }
        
        .loan-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--muted);
        }
        
        /* ====== USER MENUS ====== */
        .mobile-user-menu {
            display: none;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }
        
        .desktop-user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        
        /* ====== HAMBURGER MENU ====== */
        .hamburger {
            display: none;
            cursor: pointer;
            width: 44px;
            height: 44px;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: transparent;
            border: none;
        }
        
        .hamburger div {
            width: 22px;
            height: 2px;
            background: #04293a;
            margin: 4px 0;
            transition: 0.2s;
        }
        
        /* ====== RESPONSIVE DESIGN ====== */
        @media (max-width: 768px) {
            .nav {
                padding: 14px 20px;
            }
            
            .nav-links {
                display: none;
            }
            
            .dashboard-container {
                padding: 90px 20px 30px;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .balance-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-header {
                display: none;
            }
            
            .table-row {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 20px;
                border-bottom: 2px solid rgba(4,102,200,0.05);
            }
            
            .table-row::before {
                content: attr(data-label);
                font-weight: 600;
                color: #04293a;
                font-size: 13px;
            }
            
            .mobile-user-menu {
                display: flex;
            }
            
            .desktop-user-menu {
                display: none;
            }
            
            .hamburger {
                display: flex;
            }
        }
        
        @media (max-width: 576px) {
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .balance-amount {
                font-size: 28px;
            }
            
            .dashboard-header h1 {
                font-size: 26px;
            }
            
            .loans-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .nav {
                padding: 12px 16px;
            }
            
            .brand h1 {
                font-size: 18px;
            }
            
            .dashboard-container {
                padding: 80px 16px 20px;
            }
            
            .action-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>

<!-- ====== NAVBAR ====== -->
<div class="nav">
    <div class="brand">
        <img src="https://images.pexels.com/photos/3183198/pexels-photo-3183198.jpeg?auto=compress&cs=tinysrgb&w=120&h=120&fit=crop" alt="Trust Bank logo">
        <h1>Trust Bank</h1>
    </div>
    
    <nav class="nav-links" id="navLinks">
        <a href="{% url 'home' %}">Home</a>
        <a href="{% url 'dashboard' %}" style="background: rgba(4,102,200,0.06); color: #0466c8;">Dashboard</a>
        <a href="{% url 'send_money' %}">Send Money</a>
        <a href="{% url 'deposit' %}">Deposit</a>
        <a href="{% url 'pay_bills' %}">Pay Bills</a>
        <a href="{% url 'cards' %}">Cards</a>
        <a href="{% url 'loan_step1' %}" style="background: linear-gradient(90deg, #0466c8, #00aaff); color: white; padding: 8px 16px; border-radius: 10px;">Apply for Loan</a>
    </nav>
    
    <div class="nav-actions">
        <div class="desktop-user-menu">
            {% if user.is_authenticated %}
                <span style="color: var(--muted); font-size: 13px; margin-right: 10px;">
                    Welcome, {{ user.first_name|default:user.username }}
                </span>
                <button class="btn btn-sm btn-outline" onclick="location.href='#'">Profile</button>
                <button class="btn btn-sm btn-primary" onclick="location.href='{% url 'logout' %}'">Logout</button>
            {% else %}
                <button class="btn btn-sm btn-outline" onclick="location.href='/'">Login</button>
            {% endif %}
        </div>
        
        <div class="mobile-user-menu">
            {% if user.is_authenticated %}
                <div class="user-avatar">
                    {{ user.first_name|first|default:"U" }}{{ user.last_name|first|default:"" }}
                </div>
                <button class="btn btn-sm btn-primary" onclick="location.href='{% url 'logout' %}'" 
                        style="margin-left: 10px; padding: 5px 10px;">Logout</button>
            {% else %}
                <div class="user-avatar">?</div>
            {% endif %}
        </div>
        
        <button class="hamburger" id="hamburger" aria-label="Menu">
            <div></div><div></div><div></div>
        </button>
    </div>
</div>
    
<!-- ====== DASHBOARD CONTENT ====== -->
<div class="dashboard-container">
    
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div>
            <h1>Dashboard</h1>
            <p class="welcome-message">
                Welcome back, 
                <span>
                    {% if user.is_authenticated %}
                        {{ user.first_name|default:user.username }}
                    {% else %}
                        Guest
                    {% endif %}
                </span> 
                | Last login: <span id="currentTime">{{ current_time|date:"F j, Y, g:i a" }}</span>
            </p>
        </div>
        
        <div class="quick-actions">
            <a href="/send-money/" class="btn btn-primary" style="text-decoration: none; display: inline-block;">Send Money</a>
            <button class="btn btn-outline" onclick="location.href='{% url 'deposit' %}'">Deposit</button>
            <a href="{% url 'loan_step1' %}" class="btn btn-outline">Apply for Loan</a>
        </div>
    </div>
    
    <!-- Balance Cards -->
    <div class="balance-grid">
        <div class="balance-card">
            <div class="balance-label">Total Balance</div>
            <div class="balance-amount" id="totalBalance">${{ account.balance|floatformat:2 }}</div>
            
            {% if account.balance == 0 %}
                <div style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                    Account: {{ account.account_number|truncatechars:12 }}
                </div>
            {% else %}
                <div class="balance-change positive" id="balanceChange">
                    Account: {{ account.account_number|truncatechars:12 }}
                </div>
            {% endif %}
        </div>
        
        <div class="balance-card secondary">
            <div class="balance-label">Available Balance</div>
            <div class="balance-amount">${{ account.balance|floatformat:2 }}</div>
            <div class="balance-change positive">Ready to use</div>
        </div>
        
        <div class="balance-card tertiary">
            <div class="balance-label">Account Number</div>
            <div class="balance-amount" style="font-size: 24px;">{{ account.account_number|truncatechars:16 }}</div>
            <div class="balance-change">{% if account.balance == 0 %}Add funds to start{% else %}Active account{% endif %}</div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="actions-grid">
        <a href="/send-money/" style="text-decoration: none; color: inherit;">
            <div class="action-card">
                <div class="action-icon">‚Üí</div>
                <h3>Send Money</h3>
                <p>Bank transfer to anyone in USA</p>
            </div>
        </a>
        
        <a href="{% url 'deposit' %}" style="text-decoration: none; color: inherit;">
            <div class="action-card">
                <div class="action-icon">+</div>
                <h3>Deposit</h3>
                <p>Add funds to your account</p>
            </div>
        </a>
        
        <a href="{% url 'pay_bills' %}" style="text-decoration: none; color: inherit;">
            <div class="action-card">
                <div class="action-icon">‚ö°</div>
                <h3>Pay Bills</h3>
                <p>Utilities, subscriptions, more</p>
            </div>
        </a>
        
        <a href="{% url 'cards' %}" style="text-decoration: none; color: inherit;">
            <div class="action-card">
                <div class="action-icon">üí≥</div>
                <h3>Cards</h3>
                <p>Manage debit & credit cards</p>
            </div>
        </a>
        
        <a href="{% url 'loan_step1' %}" style="text-decoration: none; color: inherit;">
            <div class="action-card">
                <div class="action-icon">üè¶</div>
                <h3>Get Loan</h3>
                <p>Personal, home, auto loans</p>
            </div>
        </a>
    </div>
    
    <!-- Recent Transactions -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2>Recent Transactions</h2>
            <!-- REMOVED: "View All" button -->
        </div>
        
        <div class="transactions-table" id="transactionsTable">
            <div class="table-header">
                <div>Description</div>
                <div>Amount</div>
                <div>Date</div>
                <div>Status</div>
            </div>
            
            {% if transactions %}
                {% for transaction in transactions|slice:":5" %}
                <div class="table-row">
                    <div>{{ transaction.description|default:"Transaction" }}</div>
                    <div class="transaction-amount {% if transaction.transaction_type == 'deposit' %}positive{% else %}negative{% endif %}">
                        {% if transaction.transaction_type == 'deposit' %}+{% else %}-{% endif %}${{ transaction.amount|floatformat:2 }}
                    </div>
                    <div>{{ transaction.created_at|date:"M d, Y" }}</div>
                    <div><span class="transaction-status status-completed">Completed</span></div>
                </div>
                {% endfor %}
            {% else %}
                <div class="table-row">
                    <div>Welcome to TrustBank</div>
                    <div class="transaction-amount positive">+$0.00</div>
                    <div>{{ current_time|date:"M d, Y" }}</div>
                    <div><span class="transaction-status status-completed">Completed</span></div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Active Loans -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2>Active Loans</h2>
            <a href="{% url 'loan_step1' %}" style="color: #0466c8; font-weight: 600; font-size: 14px;">Apply for New Loan</a>
        </div>
        
        <div class="loans-grid" id="loansGrid">
            {% if loans %}
                {% for loan in loans %}
                <div class="loan-card">
                    <div class="loan-header">
                        <div class="loan-type">{{ loan.loan_type }}</div>
                        <div style="color: var(--muted); font-weight: 600; font-size: 14px;">{{ loan.status }}</div>
                    </div>
                    <div class="loan-amount">${{ loan.amount|floatformat:2 }}</div>
                    <div style="color: var(--muted); font-size: 14px;">Applied on {{ loan.created_at|date:"M d, Y" }}</div>
                    
                    <div class="loan-progress">
                        <div class="loan-progress-bar" style="width: {% if loan.status == 'approved' %}100%{% elif loan.status == 'pending' %}50%{% else %}0%{% endif %}"></div>
                    </div>
                    
                    <div class="loan-info">
                        <div>Status: {{ loan.status|title }}</div>
                        <div>${{ loan.monthly_payment|default:0|floatformat:2 }}/mo</div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="loan-card">
                    <div class="loan-header">
                        <div class="loan-type">No Active Loans</div>
                        <div style="color: var(--muted); font-weight: 600; font-size: 14px;">Apply Now</div>
                    </div>
                    <div class="loan-amount">$0.00</div>
                    <div style="color: var(--muted); font-size: 14px;">You have no active loans</div>
                    
                    <div class="loan-progress">
                        <div class="loan-progress-bar" style="width: 0%"></div>
                    </div>
                    
                    <div class="loan-info">
                        <div>Status: No loans</div>
                        <div>$0/mo</div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- ====== SIMPLE JAVASCRIPT ====== -->
<script>
    // Mobile menu toggle
    document.getElementById('hamburger')?.addEventListener('click', function() {
        const navLinks = document.getElementById('navLinks');
        if (navLinks.style.display === 'flex') {
            navLinks.style.display = 'none';
        } else {
            navLinks.style.display = 'flex';
            navLinks.style.flexDirection = 'column';
            navLinks.style.position = 'absolute';
            navLinks.style.top = '70px';
            navLinks.style.left = '0';
            navLinks.style.right = '0';
            navLinks.style.backgroundColor = 'white';
            navLinks.style.padding = '20px';
            navLinks.style.boxShadow = '0 10px 20px rgba(0,0,0,0.1)';
            navLinks.style.gap = '15px';
            navLinks.style.zIndex = '1000';
        }
    });
    
    // Update time display
    function updateTime() {
        const now = new Date();
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
            timeElement.textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    }
    updateTime();
    setInterval(updateTime, 60000);
    
    // Simple fixes
    document.addEventListener('DOMContentLoaded', function() {
        // Add refresh button to balance card
        const balanceCard = document.querySelector('.balance-card');
        if (balanceCard) {
            const refreshBtn = document.createElement('button');
            refreshBtn.innerHTML = 'üîÑ Refresh';
            refreshBtn.onclick = function() { location.reload(); };
            refreshBtn.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(255,255,255,0.3);
                color: white;
                border: 1px solid rgba(255,255,255,0.5);
                padding: 6px 12px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 12px;
                font-weight: 600;
            `;
            balanceCard.style.position = 'relative';
            balanceCard.appendChild(refreshBtn);
        }
        
        // Make sure Send Money works on all elements
        const sendMoneyUrl = '/send-money/';
        
        // Fix any remaining Send Money elements
        setTimeout(function() {
            document.querySelectorAll('*').forEach(el => {
                const text = el.textContent ? el.textContent.trim() : '';
                if (text === 'Send Money') {
                    if (el.tagName === 'BUTTON') {
                        el.onclick = function(e) {
                            e.preventDefault();
                            window.location.href = sendMoneyUrl;
                        };
                    } else if (el.tagName === 'A' && !el.href.includes('send-money')) {
                        el.href = sendMoneyUrl;
                    } else if (el.tagName === 'DIV' || el.tagName === 'SPAN') {
                        el.style.cursor = 'pointer';
                        el.onclick = function() {
                            window.location.href = sendMoneyUrl;
                        };
                    }
                }
            });
        }, 100);
    });
</script>

</body>
</html>